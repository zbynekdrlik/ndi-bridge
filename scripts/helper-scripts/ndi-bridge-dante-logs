#!/bin/bash
# View Dante audio bridge logs

echo "================================"
echo "    Dante Audio Bridge Logs     "
echo "================================"
echo

# Function to show service logs
show_service_logs() {
    local service=$1
    local description=$2
    
    if systemctl list-units --all | grep -q "$service"; then
        echo "$description:"
        echo "--------------------------------"
        systemctl status $service --no-pager | head -10
        echo
        echo "Recent log entries:"
        journalctl -u $service -n 20 --no-pager
        echo
        echo "================================"
        echo
    fi
}

# Check if follow mode is requested
if [ "$1" = "-f" ] || [ "$1" = "--follow" ]; then
    echo "Following all Dante-related logs (Ctrl+C to exit)..."
    echo
    journalctl -u statime.service -u inferno-alsa.service -u usb-dante-bridge.service -f
else
    # Show status and logs for each service
    show_service_logs "statime.service" "Statime PTP Daemon"
    show_service_logs "inferno-alsa.service" "Inferno ALSA Service"
    show_service_logs "usb-dante-bridge.service" "USB to Dante Bridge"
    
    echo "Tip: Use 'ndi-bridge-dante-logs -f' to follow logs in real-time"
    echo "     Use 'ndi-bridge-dante-status' to see current status"
fi