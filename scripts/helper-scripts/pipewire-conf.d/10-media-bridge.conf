# Media Bridge PipeWire Configuration
# Low latency settings for intercom and display

context.properties = {
    # Low latency configuration
    default.clock.rate = 48000
    default.clock.quantum = 256      # ~5.3ms latency at 48kHz (normal operation)
    default.clock.min-quantum = 32   # ~0.67ms minimum (for self-monitoring)
    default.clock.max-quantum = 512  # ~10.6ms maximum
    
    # Module loading timeout
    core.daemon = true
    core.name = pipewire-0
    
    # Memory locking for real-time performance
    mem.allow-mlock = true
    mem.warn-mlock = false
    
    # Link settings for low latency
    link.max-buffers = 16
    
    # Real-time scheduling
    rt.prio = 88
    rt.time.soft = 200000
    rt.time.hard = 200000
}

context.spa-libs = {
    audio.convert.* = audioconvert/libspa-audioconvert
    alsa.* = alsa/libspa-alsa
    v4l2.* = v4l2/libspa-v4l2
}

context.modules = [
    # Native protocol with socket activation
    {
        name = libpipewire-module-protocol-native
        flags = [ ifexists nofail ]
    }
    
    # RT support
    {
        name = libpipewire-module-rt
        args = {
            nice.level = -11
            rt.prio = 88
            rt.time.soft = 200000
            rt.time.hard = 200000
        }
        flags = [ ifexists nofail ]
    }
    
    # Client node support
    { name = libpipewire-module-client-node }
    
    # Device support
    { name = libpipewire-module-client-device }
    
    # Adapter for legacy apps
    { name = libpipewire-module-adapter }
    
    # Metadata for default devices
    { name = libpipewire-module-metadata }
    
    # Session manager interface
    { name = libpipewire-module-session-manager }
]