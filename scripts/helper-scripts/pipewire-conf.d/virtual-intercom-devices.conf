# Virtual Intercom Devices Configuration
# Proper PipeWire configuration for intercom virtual devices
# Replaces custom audio manager script approach

context.modules = [
    {
        # Virtual speaker sink for Chrome output
        name = libpipewire-module-null-sink
        args = {
            sink.name = "intercom-speaker"
            node.description = "Intercom Speaker"
            media.class = "Audio/Sink"
            audio.channels = 2
            audio.position = [ FL FR ]
            audio.rate = 48000
            audio.format = "F32LE"
            node.group = "intercom"
        }
    },
    {
        # Virtual microphone source for Chrome input  
        name = libpipewire-module-null-sink
        args = {
            sink.name = "intercom-mic-sink"
            node.description = "Intercom Microphone Sink"
            media.class = "Audio/Sink"
            audio.channels = 2
            audio.position = [ FL FR ]
            audio.rate = 48000
            audio.format = "F32LE"
            node.group = "intercom"
        }
    },
    {
        # Create virtual source from mic sink monitor
        name = libpipewire-module-virtual-source
        args = {
            source.name = "intercom-microphone"
            master = "intercom-mic-sink.monitor"
            node.description = "Intercom Microphone"
            media.class = "Audio/Source"
            audio.channels = 2
            audio.position = [ FL FR ]
            audio.rate = 48000
            audio.format = "F32LE"
            node.group = "intercom"
        }
    },
    {
        # Loopback from USB mic to virtual mic (when USB present)
        name = libpipewire-module-loopback
        args = {
            audio.position = [ FL FR ]
            capture.props = {
                stream.capture.sink = true
                node.name = "usb-to-intercom-mic"
                node.description = "USB to Intercom Mic"
                target.object = "intercom-mic-sink"
            }
            playback.props = {
                node.name = "usb-to-intercom-mic.input"
                node.passive = true
                node.target = "usb_audio_source"
            }
            node.group = "intercom"
        }
    }
]