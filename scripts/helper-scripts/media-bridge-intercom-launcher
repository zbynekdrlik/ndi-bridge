#!/bin/bash
# VDO.Ninja Intercom Launcher - PipeWire only

# PipeWire is required
if ! command -v pipewire &> /dev/null || ! command -v wireplumber &> /dev/null; then
    echo "ERROR: PipeWire and WirePlumber are required but not installed"
    echo "Please run: apt-get install pipewire pipewire-pulse wireplumber"
    exit 1
fi

# Wait for user PipeWire to be ready (via PulseAudio compatibility)
for i in {1..20}; do
    if pactl info >/dev/null 2>&1; then
        echo "User PipeWire is ready"
        break
    fi
    echo "Waiting for user PipeWire... (attempt $i)"
    sleep 1
done

echo "Starting Media Bridge Intercom with PipeWire..."
exec /usr/local/bin/media-bridge-intercom-pipewire "$@"
