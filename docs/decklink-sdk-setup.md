# DeckLink SDK Setup Instructions

## Important Legal Notice
The DeckLink SDK files are proprietary files owned by Blackmagic Design and cannot be redistributed in this repository due to licensing restrictions.

## Quick Setup Steps

1. **Download the DeckLink SDK** from [Blackmagic Design Support](https://www.blackmagicdesign.com/support/)
   - Look for "Desktop Video Developer SDK" (version 14.4 or later)

2. **Copy all IDL files to docs/reference**:
   ```cmd
   copy "path\to\SDK\Win\include\*.idl" "path\to\media-bridge\docs\reference\"
   copy "path\to\SDK\Win\include\DeckLinkAPIVersion.h" "path\to\media-bridge\docs\reference\"
   ```

3. **Generate the required files** (from VS Developer Command Prompt):
   ```cmd
   cd "path\to\media-bridge\docs\reference"
   generate-decklink-api.bat
   ```

4. **Build the project** with DeckLink support enabled.

## Detailed Instructions

### Step 1: Obtaining the DeckLink SDK

1. Visit [Blackmagic Design Support](https://www.blackmagicdesign.com/support/)
2. Navigate to "Latest Downloads"
3. Find "Desktop Video Developer SDK" (currently version 14.4 or later)
4. Download for Windows
5. Extract the ZIP file

### Step 2: Copy Required Files

Copy all the IDL files and the version header from the SDK to your project:

```cmd
# From Windows Command Prompt or PowerShell:
cd "path\to\Blackmagic DeckLink SDK 14.4\Win\include"
copy *.idl "path\to\media-bridge\docs\reference\"
copy DeckLinkAPIVersion.h "path\to\media-bridge\docs\reference\"
```

### Step 3: Generate C++ Files

The IDL files must be compiled using the Microsoft IDL compiler (MIDL) to generate the C++ header and source files.

1. **Open Visual Studio Developer Command Prompt**:
   - Start Menu → Visual Studio 2019/2022 → Developer Command Prompt

2. **Navigate to the reference directory**:
   ```cmd
   cd "C:\path\to\media-bridge\docs\reference"
   ```

3. **Run the generation script**:
   ```cmd
   generate-decklink-api.bat
   ```

The script will:
- Check that you're in the Developer Command Prompt
- Look for `DeckLinkAPI.idl` in the current directory
- Generate `DeckLinkAPI_h.h` and `DeckLinkAPI_i.c`
- Clean up temporary files

### Alternative: Manual MIDL compilation

If you prefer to run MIDL directly:
```cmd
cd "path\to\media-bridge\docs\reference"
midl /h DeckLinkAPI_h.h /iid DeckLinkAPI_i.c DeckLinkAPI.idl
```

### Step 4: Verify Installation

After generating the files, you should have in `docs/reference/`:
- All `.idl` files (copied from SDK)
- `DeckLinkAPIVersion.h` (copied from SDK)
- `DeckLinkAPI_h.h` (generated by MIDL)
- `DeckLinkAPI_i.c` (generated by MIDL)

Build the project:
```bash
mkdir build
cd build
cmake ..
```

You should see:
```
DeckLink SDK found: .../docs/reference
```

## Building Without DeckLink Support

If you don't need DeckLink support, you can disable it:
```bash
cmake -DUSE_DECKLINK=OFF ..
```

## Troubleshooting

### "midl.exe not found"
- Make sure you're using **Visual Studio Developer Command Prompt**, not regular Command Prompt
- The Developer Command Prompt has the necessary build tools in PATH

### "DeckLinkAPI.idl not found"
- Make sure you copied all the IDL files from the SDK to `docs\reference\`
- Check that you're in the correct directory when running the script

### MIDL Compilation Errors
- Ensure you have all the IDL files from the SDK (some reference each other)
- Copy `DeckLinkAPIVersion.h` as well - it may be needed
- Some warnings during MIDL compilation are normal

### CMake doesn't find DeckLink
- Check that both `DeckLinkAPI_h.h` and `DeckLinkAPI_i.c` exist in `docs\reference\`
- These files are generated by MIDL, not copied from the SDK

## Runtime Requirements

Even with the SDK installed for building, users need:
1. **Desktop Video Drivers**: Download from Blackmagic Design support
2. **DeckLink Hardware**: Any Blackmagic capture card with input support
3. **Windows**: Visual C++ Redistributables (usually already installed)

## Testing DeckLink Support

After building with DeckLink support:
```bash
# List DeckLink devices
ndi-capture.exe -t dl -l

# Use a specific DeckLink device
ndi-capture.exe -t dl -d "DeckLink Mini Recorder" -n "My NDI Stream"
```

## License Compliance
- DO NOT commit the SDK files to any public repository
- The `.gitignore` file is configured to exclude these files
- Users must obtain the SDK from Blackmagic Design directly
