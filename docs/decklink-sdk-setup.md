# DeckLink SDK Setup Instructions

## Important Legal Notice
The DeckLink SDK files are proprietary files owned by Blackmagic Design and cannot be redistributed in this repository due to licensing restrictions.

## Quick Setup Steps

1. **Download the DeckLink SDK** from [Blackmagic Design Support](https://www.blackmagicdesign.com/support/)
   - Look for "Desktop Video Developer SDK" (version 14.4 or later)

2. **Copy the IDL file to the project**:
   ```cmd
   copy "path\to\SDK\Win\include\DeckLinkAPI.idl" "path\to\ndi-bridge\docs\reference\"
   ```

3. **Generate the required files** (from VS Developer Command Prompt):
   ```cmd
   cd "path\to\ndi-bridge"
   scripts\generate-decklink-api.bat
   ```

4. **Build the project** with DeckLink support enabled.

## Detailed Instructions

### Step 1: Obtaining the DeckLink SDK

1. Visit [Blackmagic Design Support](https://www.blackmagicdesign.com/support/)
2. Navigate to "Latest Downloads"
3. Find "Desktop Video Developer SDK" (currently version 14.4 or later)
4. Download for Windows
5. Extract the ZIP file

### Step 2: Copy Required Files

The DeckLink SDK provides IDL (Interface Definition Language) files that must be compiled. Copy this file to your project:

```cmd
# From the DeckLink SDK directory:
copy "Blackmagic DeckLink SDK 14.4\Win\include\DeckLinkAPI.idl" "docs\reference\"
```

### Step 3: Generate C++ Files

The IDL file must be compiled using the Microsoft IDL compiler (MIDL) to generate the C++ header and source files.

#### Method 1: Using the provided script (Recommended)

1. **Open Visual Studio Developer Command Prompt**:
   - Start Menu → Visual Studio 2019/2022 → Developer Command Prompt

2. **Navigate to your project**:
   ```cmd
   cd "C:\path\to\ndi-bridge"
   ```

3. **Run the generation script**:
   ```cmd
   scripts\generate-decklink-api.bat
   ```

The script will:
- Check that you're in the Developer Command Prompt
- Look for `DeckLinkAPI.idl` in `docs\reference\`
- Generate `DeckLinkAPI_h.h` and `DeckLinkAPI_i.c`
- Clean up temporary files

#### Method 2: Manual MIDL compilation

1. **Open Visual Studio Developer Command Prompt**

2. **Navigate to the reference directory**:
   ```cmd
   cd "path\to\ndi-bridge\docs\reference"
   ```

3. **Run MIDL compiler**:
   ```cmd
   midl /h DeckLinkAPI_h.h /iid DeckLinkAPI_i.c DeckLinkAPI.idl
   ```

### Step 4: Verify Installation

After generating the files, you should have in `docs/reference/`:
- `DeckLinkAPI.idl` (original IDL file)
- `DeckLinkAPI_h.h` (generated header)
- `DeckLinkAPI_i.c` (generated interface IDs)

Build the project:
```bash
mkdir build
cd build
cmake ..
```

You should see:
```
DeckLink SDK found: .../docs/reference
```

## Building Without DeckLink Support

If you don't need DeckLink support, you can disable it:
```bash
cmake -DUSE_DECKLINK=OFF ..
```

## Troubleshooting

### "midl.exe not found"
- Make sure you're using **Visual Studio Developer Command Prompt**, not regular Command Prompt
- The Developer Command Prompt has the necessary build tools in PATH

### "DeckLinkAPI.idl not found in docs\reference"
- Make sure you copied the IDL file from the SDK to `docs\reference\`
- The file should be at: `ndi-bridge\docs\reference\DeckLinkAPI.idl`

### MIDL Compilation Errors
- Ensure you have the correct DeckLinkAPI.idl file
- Some warnings during MIDL compilation are normal
- The script will clean up temporary files automatically

### CMake doesn't find DeckLink
- Check that both `DeckLinkAPI_h.h` and `DeckLinkAPI_i.c` exist in `docs\reference\`
- These files are generated by MIDL, not copied from the SDK

## Runtime Requirements

Even with the SDK installed for building, users need:
1. **Desktop Video Drivers**: Download from Blackmagic Design support
2. **DeckLink Hardware**: Any Blackmagic capture card with input support
3. **Windows**: Visual C++ Redistributables (usually already installed)

## Testing DeckLink Support

After building with DeckLink support:
```bash
# List DeckLink devices
ndi-bridge.exe -t dl -l

# Use a specific DeckLink device
ndi-bridge.exe -t dl -d "DeckLink Mini Recorder" -n "My NDI Stream"
```

## License Compliance
- DO NOT commit the SDK files to any public repository
- The `.gitignore` file is configured to exclude these files
- Users must obtain the SDK from Blackmagic Design directly
